<div class="sr5-hud-container">
    <div class="hud-header">
        <div class="portrait-container" title="시트 열기/닫기">
            <img src="{{img}}" class="token-portrait">
            <div class="armor-badge" title="물리 피해 저항판정">
                <i class="fas fa-shield-alt"></i>
                <span class="armor-num">{{armorValue}}</span>
            </div>
        </div>

        <div class="token-details">
            <div class="token-name">{{name}}</div>
            <div class="track-physical">물리: {{track.physical.value}} / {{track.physical.base}}</div>
            <div class="track-stun">기절: {{track.stun.value}} / {{track.stun.base}}</div>
        </div>
    </div>

    <div class="action-grid">
        <button class="action-btn toggle-btn" data-target="skill-menu">기술</button>
        <button class="action-btn toggle-btn" data-target="inventory-menu">소지품</button>
        <button class="action-btn toggle-btn special-btn {{#unless specialButtonLabel}}hidden-btn{{/unless}}"
                data-target="special-menu">
            {{#if specialButtonLabel}}
            {{specialButtonLabel}}
            {{else}}
            특수
            {{/if}}
        </button>
        <button class="action-btn toggle-btn" data-target="action-menu">행동</button>
    </div>

    {{!-- 행동 메뉴 --}}
    <div id="action-menu" class="dropdown-content inventory-section hidden">
        <div class="inventory-header">행동 목록</div>
        <div class="skill-list-container">
            {{#each actionData as |items category|}}
            <div class="inventory-category">
                <div class="category-title" style="background: #444; color: #ffda44; padding: 2px 5px; font-size: 0.8em; margin-top: 5px;">
                    {{category}}
                </div>
                {{#each items}}
                <div class="inventory-item skill-item"
                     data-item-id="{{this.id}}"
                     data-id="{{this.id}}"
                     data-action-id="{{this.actionId}}"
                     data-pack="{{this.pack}}"
                     data-is-pack="{{this.isPack}}">

                    <img class="item-roll" src="{{this.img}}" width="20" height="20" style="margin-right: 5px; border-radius: 2px; cursor: pointer;" title="굴림">
                    <span class="skill-name item-name" style="cursor: pointer;">{{this.name}}</span>

                    <span class="skill-type" style="font-size: 0.7em; color: #888; margin-left: auto;">
                        {{#if this.isPack}}일반 행동{{else}}{{this.label}}{{/if}}
                    </span>
                </div>
                {{/each}}
            </div>
            {{/each}}
        </div>
    </div>

    {{!-- 기술 메뉴 --}}
    <div id="skill-menu" class="sub-menu hidden">
        <button class="skill-type-btn" data-target="active-list">활성형</button>
        <button class="skill-type-btn" data-target="knowledge-list">지식</button>
        <button class="skill-type-btn" data-target="language-list">언어</button>
    </div>

    <div id="active-list" class="dropdown-content hidden">
        <div class="search-box">
            <input type="text" class="skill-search" placeholder="활성형 기술 검색...">
            <label class="filter-label">
                <input type="checkbox" class="filter-zero"> 등급 >0
            </label>
        </div>
        <div class="skill-list-container">
            {{#each skills.active}}
            <div class="skill-item" data-id="{{@key}}">
                <span class="skill-name">{{this.displayName}}</span>
                <span class="skill-rating">{{this.value}} 등급</span>
            </div>
            {{/each}}
        </div>
    </div>

    <div id="knowledge-list" class="dropdown-content hidden">
        <div class="search-box">
            <input type="text" class="skill-search" placeholder="지식 기술 검색...">
            <label class="filter-label">
                <input type="checkbox" class="filter-zero"> 등급 >0
            </label>
        </div>
        <div class="skill-list-container">
            {{#each skills.knowledge.academic.value}}
            <div class="skill-item knowledge-item" data-id="{{@key}}">
                <div class="skill-info"><span class="skill-name">{{this.name}}</span><span class="skill-type">[학술]</span></div>
                <span class="skill-rating">{{this.value}} 등급</span>
            </div>
            {{/each}}
            {{#each skills.knowledge.interests.value}}
            <div class="skill-item knowledge-item" data-id="{{@key}}">
                <div class="skill-info"><span class="skill-name">{{this.name}}</span><span class="skill-type">[흥미]</span></div>
                <span class="skill-rating">{{this.value}} 등급</span>
            </div>
            {{/each}}
            {{#each skills.knowledge.professional.value}}
            <div class="skill-item knowledge-item" data-id="{{@key}}">
                <div class="skill-info"><span class="skill-name">{{this.name}}</span><span class="skill-type">[전문]</span></div>
                <span class="skill-rating">{{this.value}} 등급</span>
            </div>
            {{/each}}
            {{#each skills.knowledge.street.value}}
            <div class="skill-item knowledge-item" data-id="{{@key}}">
                <div class="skill-info"><span class="skill-name">{{this.name}}</span><span class="skill-type">[거리]</span></div>
                <span class="skill-rating">{{this.value}} 등급</span>
            </div>
            {{/each}}
        </div>
    </div>

    <div id="language-list" class="dropdown-content hidden">
        <div class="search-box">
            <input type="text" class="skill-search" placeholder="언어 검색...">
            <label class="filter-label">
                <input type="checkbox" class="filter-zero"> 등급 >0
            </label>
        </div>
        <div class="skill-list-container">
            {{#each skills.language.value}}
            {{#if this.name}}
            <div class="skill-item" data-id="{{@key}}">
                <span class="skill-name">{{this.name}}</span>
                <span class="skill-rating">{{#if this.isNative}}N{{else}}{{this.value}} 등급{{/if}}</span>
            </div>
            {{/if}}
            {{/each}}
        </div>
    </div>

    {{!-- 소지품 메뉴 --}}
    <div id="inventory-menu" class="inventory-section dropdown-content hidden">
        <div class="inventory-header">소지품 목록</div>
        <div class="skill-list-container">
            {{#each inventory as |items category|}}
            <div class="inventory-category">
                <div class="category-title" style="background: #444; color: #ffda44; padding: 2px 5px; font-size: 0.8em; margin-top: 5px;">
                    {{category}}
                </div>
                {{#each items}}
                <div class="inventory-item skill-item" data-id="{{this.id}}">
                    <img src="{{this.img}}" class="item-roll" width="20" height="20" style="margin-right: 5px; border-radius: 2px; cursor: pointer;" title="판정 굴림">
                    <span class="skill-name item-name" style="cursor: pointer;">{{this.name}}</span>
                    <span class="skill-type" style="font-size: 0.7em; color: #888; margin-left: auto;">{{this.label}}</span>
                </div>
                {{/each}}
            </div>
            {{/each}}
        </div>
    </div>

    {{!-- 특수 메뉴 (마법/공명) --}}
    {{#if specialData}}
    <div id="special-menu" class="inventory-section dropdown-content hidden">
        <div class="inventory-header">{{specialButtonLabel}} 목록</div>
        <div class="skill-list-container">
            {{#each specialData as |items category|}}
            <div class="inventory-category">
                <div class="category-title" style="background: #444; color: #44daff; padding: 2px 5px; font-size: 0.8em; margin-top: 5px;">
                    {{category}}
                </div>
                {{#each items}}
                <div class="inventory-item skill-item" data-id="{{this.id}}">
                    <img src="{{this.img}}" class="item-roll" width="20" height="20" style="margin-right: 5px; border-radius: 2px; cursor: pointer;">
                    <span class="skill-name item-name" style="cursor: pointer;">{{this.name}}</span>
                    <span class="skill-type" style="font-size: 0.7em; color: #888; margin-left: auto;">{{this.label}}</span>
                </div>
                {{/each}}
            </div>
            {{/each}}
        </div>
    </div>
    {{/if}}
</div>